<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <script src="https://js.onepipe.io/v1"></script>
</head>
<body>
<h1>This is a demo payment</h1>
<p>Click the button to pay N10</p>
<button type="button" onclick="OnePipePay()">Click me!</button>
<script type="text/javascript">
	function generateUniqueRef() {
		var min = 10000000000000;
		var max = 99999999999999;
		var transRef = (Math.random() * (max - min) + min);
		transRef = Math.round(transRef);
		return transRef.toString(); //var reqRef = transRef + '01';
	}
	function OnePipePay() {
		var transRef = generateUniqueRef();
		var handler = OnePipePopup.setup({
			requestData: {
				request_ref: transRef,//generate a unique number
				request_type: 'charge',
				api_key: 'nphJDQXeYvkUaARYtaXA_948055ac888e47e8881721e903df21a7',//API key from your console
				auth_provider: 'QTTransfer',
				transaction: {
					amount: 1000,
					currency: "NGN",
					transaction_ref: transRef,//generate a unique number
					transaction_desc: 'demo payment',
					customer: {
						customer_ref: '12345678800',//how you identify the customer
						firstname: 'Alex',
						surname: 'Idowu',
						email: 'alexidowu25@gmail.com',
						mobile_no: '2348166480703'
					}
				},
				options:{
					close_popup: {
						card : "onSuccess"
					}
				}
			},
			callback: function (response) {

				//let's log the response
				console.log(response);

				// Contents of data is based on what OnePipe returns
				let message = (response.message || response.data.message),
					reference = response.reference,
					status = response.status,
					parentTransRef = response.parentTransRef,
					transRef = response.transRef,
					paymentmethod = response.paymentmethod,
					optionsTransRef = response.optionsTransRef,
					data = response.data,
					provider_response_code = data.provider_response_code,
					provider = data.provider,
					charge_status = data.charge_status;

				if(data.error){
					error = data.error,
						error_code = error.code,
						error_message = error.message;
				}


				//lets just see what's passed
				var feedback = '';
				feedback += "payment method: " + paymentmethod + "\n";
				feedback += "message: " + message + "\n";
				feedback += "reference: " + reference + "\n";
				feedback += "status: " + status + "\n";
				feedback += "parentTransRef: " + parentTransRef + "\n";
				feedback += "transRef: " + transRef + "\n";

				console.log(feedback);
				alert(feedback);
			},
			onClose: function () {
				alert('You cancelled the payment process');
			}
		});

		handler.execute();

	}
</script>
</body>
</html>
